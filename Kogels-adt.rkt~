#lang racket
(provide maak-kogels-adt)

(require "teken-adt.rkt")
(require "Abstracties.rkt")

(require "Kogel.rkt")



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;   Alexandre Kahn    ;;;;;;;;;
;;;;;;;;;      500067         ;;;;;;;;;
;;;;;;;;;     1e BA CW        ;;;;;;;;;
;;;;;;;;; alexkahn@vub.ac.be  ;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


;;;;;;;;;;;;;;
;;Kogels ADT;;
;;;;;;;;;;;;;;

;Dit ADT zal als doel hebben om verschillende kogels te maken en te zorgen dat deze elk de correcte handelingen doen.
(define (maak-kogels-adt)
  (define kogels '())
  (define (maak-kogel! posx teken-adt) ;wordt opgeroepen bij schieten
    (let ((nieuwe-kogel (maak-kogel-adt posx)))
      (set! kogels (cons  nieuwe-kogel kogels)) ;maakt dmv van cons cellen een lijst met kogels. Efficienter door van voor te consen.
      ;((nieuwe-kogel 'schiet!) posx teken-adt) ;Zorgt dat de kogel afgeschoten wordt
      ((teken-adt 'nieuwe-kogel!) nieuwe-kogel)
      ((teken-adt 'teken-kogel!) nieuwe-kogel)
      ))

  (define (loop-over-kogels functie) ;Zorgt dat functies over de kogels gemapt kunnen worden.
    (map functie kogels))

  (define (teken! teken-adt)
    (for-each (lambda (kogel-adt)
                ((kogel-adt 'teken!) teken-adt))
              kogels))
  (define (beweeg! teken-adt vloot-adt)
    (for-each (lambda (kogel-adt)
                ((kogel-adt 'beweeg!) teken-adt)
                ((kogel-adt 'schietlus) teken-adt vloot-adt))
              kogels))
              (define (delete-dode-aliens)
                (define (delete-loop lijst reslijst)
                  (if (not (null? lijst))
                      (if (= ((car lijst) 'levens) 0)
                          (delete-loop (cdr lijst) reslijst)
                          (delete-loop (cdr lijst) (cons (car lijst) reslijst)))
                      (set! vloot (reverse reslijst))))
                (delete-loop vloot '()))
  (define (dispatch msg)
    (cond ((eq? msg 'maak-kogel!) maak-kogel!)
          ((eq? msg 'kogels) kogels)
          ((eq? msg 'beweeg!) beweeg!)
          ((eq? msg 'teken!) teken!)
          ))
  dispatch)
